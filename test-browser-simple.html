<!DOCTYPE html>
<html>
<head>
    <title>JTCSV Browser Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 8px;
            min-width: 120px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
            display: block;
        }
        
        .stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #3b82f6;
        }
        
        .stat-value.success {
            color: #10b981;
        }
        
        .tests-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .test-card h2 {
            font-size: 1.3rem;
            color: #e2e8f0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-card h2 i {
            color: #3b82f6;
        }
        
        .test-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 10px 20px;
            background: linear-gradient(90deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background: linear-gradient(90deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        input[type="file"] {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #e2e8f0;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .result-container {
            margin-top: 15px;
        }
        
        pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            max-height: 300px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .success {
            color: #10b981;
            border-left: 4px solid #10b981;
        }
        
        .error {
            color: #ef4444;
            border-left: 4px solid #ef4444;
        }
        
        .features-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .features-title {
            font-size: 1.5rem;
            color: #e2e8f0;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
        }
        
        .feature-icon i {
            font-size: 1.5rem;
            color: #3b82f6;
        }
        
        .feature-card h4 {
            font-size: 1.1rem;
            color: #e2e8f0;
            margin-bottom: 10px;
        }
        
        .feature-card p {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .tests-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats {
                flex-direction: column;
                align-items: center;
            }
            
            .stat {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header Section -->
        <header class="header">
            <h1><i class="fas fa-rocket"></i> JTCSV Browser Test</h1>
            <p class="subtitle">Interactive JSON ↔ CSV converter with real-time preview and security features</p>
            
            <div class="stats">
                <div class="stat">
                    <span class="stat-label">Test Mode</span>
                    <span class="stat-value">Simple</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Status</span>
                    <span class="stat-value success">Ready</span>
                </div>
            </div>
        </header>

        <!-- Main Tests Section -->
        <main>
            <div class="tests-container">
                <!-- Test 1: JSON to CSV -->
                <div class="test-card">
                    <h2><i class="fas fa-file-export"></i> JSON to CSV Conversion</h2>
                    <div class="test-controls">
                        <button onclick="testJsonToCsv()">
                            <i class="fas fa-play"></i> Run Test
                        </button>
                        <button onclick="showJsonExample()">
                            <i class="fas fa-eye"></i> Show Example
                        </button>
                    </div>
                    <div class="result-container" id="result1"></div>
                </div>

                <!-- Test 2: CSV to JSON -->
                <div class="test-card">
                    <h2><i class="fas fa-file-import"></i> CSV to JSON Conversion</h2>
                    <div class="test-controls">
                        <button onclick="testCsvToJson()">
                            <i class="fas fa-play"></i> Run Test
                        </button>
                        <button onclick="showCsvExample()">
                            <i class="fas fa-eye"></i> Show Example
                        </button>
                    </div>
                    <div class="result-container" id="result2"></div>
                </div>

                <!-- Test 3: File Upload -->
                <div class="test-card">
                    <h2><i class="fas fa-upload"></i> CSV File Upload</h2>
                    <input type="file" id="csvFile" accept=".csv,.txt">
                    <div class="test-controls">
                        <button onclick="testFileUpload()">
                            <i class="fas fa-cogs"></i> Parse File
                        </button>
                        <button onclick="clearFileInput()">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                    <div class="result-container" id="result3"></div>
                </div>

                <!-- Test 4: Download CSV -->
                <div class="test-card">
                    <h2><i class="fas fa-download"></i> Download CSV</h2>
                    <div class="test-controls">
                        <button onclick="testDownloadCsv()">
                            <i class="fas fa-download"></i> Download Test CSV
                        </button>
                        <button onclick="generateRandomData()">
                            <i class="fas fa-random"></i> Random Data
                        </button>
                    </div>
                    <div class="result-container" id="result4"></div>
                </div>
            </div>

            <!-- Features Section -->
            <div class="features-section">
                <h3 class="features-title"><i class="fas fa-star"></i> Key Features</h3>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h4>Fast-Path Engine</h4>
                        <p>Optimized parsing with automatic strategy selection for maximum performance</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h4>Security First</h4>
                        <p>Built-in CSV injection protection to prevent formula execution attacks</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-stream"></i>
                        </div>
                        <h4>NDJSON Support</h4>
                        <p>Streaming processing for large JSON files with Newline Delimited JSON</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-plug"></i>
                        </div>
                        <h4>Plugin System</h4>
                        <p>Extensible architecture with middleware and hooks for custom functionality</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="dist/jtcsv.umd.js"></script>
    <script>
        // Utility function for logging results
        function logResult(elementId, message, isError = false) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const icon = isError ? '❌' : '✅';
            const className = isError ? 'error' : 'success';
            
            element.innerHTML = `
                <pre class="${className}">
${icon} [${timestamp}] ${isError ? 'Error' : 'Success'}
${message}
                </pre>
            `;
        }

        // Test 1: JSON to CSV
        function testJsonToCsv() {
            try {
                const testData = [
                    { id: 1, name: 'John Doe', email: 'john@example.com', active: true },
                    { id: 2, name: 'Jane Smith', email: 'jane@example.com', active: false },
                    { id: 3, name: 'Bob Johnson', email: 'bob@example.com', active: true }
                ];
                
                const csv = window.jtcsv.jsonToCsv(testData, {
                    delimiter: ',',
                    includeHeaders: true,
                    preventCsvInjection: true,
                    quoteStrings: true
                });
                
                logResult('result1', `CSV generated (${testData.length} rows):\n\n${csv}`);
            } catch (error) {
                logResult('result1', `Error: ${error.message}\n\nStack: ${error.stack}`, true);
            }
        }

        // Test 2: CSV to JSON
        function testCsvToJson() {
            try {
                const csv = `id,name,email,active
1,"John Doe",john@example.com,true
2,"Jane Smith",jane@example.com,false
3,"Bob Johnson",bob@example.com,true`;
                
                const json = window.jtcsv.csvToJson(csv, {
                    delimiter: ',',
                    parseNumbers: true,
                    parseBooleans: true
                });
                
                logResult('result2', `JSON parsed (${json.length} rows):\n\n${JSON.stringify(json, null, 2)}`);
            } catch (error) {
                logResult('result2', `Error: ${error.message}`, true);
            }
        }

        // Test 3: File Upload
        function testFileUpload() {
            const fileInput = document.getElementById('csvFile');
            if (!fileInput.files.length) {
                logResult('result3', 'Please select a CSV file first', true);
                return;
            }
            
            const file = fileInput.files[0];
            
            logResult('result3', `Processing file: ${file.name} (${(file.size / 1024).toFixed(2)} KB)...`);
            
            window.jtcsv.parseCsvFile(file, {
                delimiter: ',',
                parseNumbers: true,
                parseBooleans: true
            }).then(json => {
                const sample = json.slice(0, 3);
                logResult('result3', `✅ Success! Parsed ${json.length} rows.\n\nSample (first 3 rows):\n${JSON.stringify(sample, null, 2)}`);
            }).catch(error => {
                logResult('result3', `❌ Error: ${error.message}`, true);
            });
        }

        // Test 4: Download CSV
        function testDownloadCsv() {
            try {
                const testData = [
                    { id: 1, name: 'Test User 1', email: 'test1@example.com', department: 'Engineering' },
                    { id: 2, name: 'Test User 2', email: 'test2@example.com', department: 'Marketing' },
                    { id: 3, name: 'Test User 3', email: 'test3@example.com', department: 'Sales' },
                    { id: 4, name: 'Test User 4', email: 'test4@example.com', department: 'Support' },
                    { id: 5, name: 'Test User 5', email: 'test5@example.com', department: 'HR' }
                ];
                
                window.jtcsv.downloadAsCsv(testData, 'test-users.csv', {
                    delimiter: ',',
                    includeHeaders: true,
                    preventCsvInjection: true
                });
                
                logResult('result4', `✅ CSV file "test-users.csv" downloaded successfully!\n\nContains ${testData.length} records.`);
            } catch (error) {
                logResult('result4', `❌ Error: ${error.message}`, true);
            }
        }

        // Helper functions
        function showJsonExample() {
            const example = [
                { id: 1, name: 'Example User', email: 'user@example.com', active: true }
            ];
            logResult('result1', `JSON Example:\n\n${JSON.stringify(example, null, 2)}`);
        }

        function showCsvExample() {
            const example = `id,name,email,active
1,"Example User",user@example.com,true
2,"Another User",another@example.com,false`;
            logResult('result2', `CSV Example:\n\n${example}`);
        }

        function clearFileInput() {
            document.getElementById('csvFile').value = '';
            document.getElementById('result3').innerHTML = '';
        }

        function generateRandomData() {
            const departments = ['Engineering', 'Marketing', 'Sales', 'Support', 'HR'];
            const testData = Array.from({ length: 10 }, (_, i) => ({
                id: i + 1,
                name: `Random User ${i + 1}`,
                email: `user${i + 1}@example.com`,
                                department: departments[Math.floor(Math.random() * departments.length)],
                salary: Math.floor(Math.random() * 100000) + 50000,
                active: Math.random() > 0.5
            }));
            
            logResult('result4', `Generated ${testData.length} random records:\n\n${JSON.stringify(testData, null, 2)}`);
        }

        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            console.log('JTCSV Browser Test loaded');
            console.log('Library version:', window.jtcsv?.version || 'Not loaded');
            
            // Check if library is loaded
            if (!window.jtcsv) {
                console.error('❌ JTCSV library not found. Make sure dist/jtcsv.umd.js is built.');
                document.body.innerHTML += `
                    <div style="background: #ef4444; color: white; padding: 20px; border-radius: 8px; margin: 20px;">
                        <h3>❌ Error: JTCSV Library Not Found</h3>
                        <p>The jtcsv library is not loaded. Please build the library first:</p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px;">
npm run build
                        </pre>
                        <p>Or run:</p>
                        <pre style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px;">
npm run build:browser
                        </pre>
                    </div>
                `;
                return;
            }
            
            // Quick test to verify library is working
            try {
                const testData = [{ test: 'value', number: 123 }];
                const csv = window.jtcsv.jsonToCsv(testData, { delimiter: ',' });
                console.log('✅ Basic test passed:', csv);
                
                // Update status
                const statusElement = document.querySelector('.stat-value.success');
                if (statusElement) {
                    statusElement.textContent = 'Connected';
                }
            } catch (error) {
                console.error('❌ Basic test failed:', error);
                
                // Update status to error
                const statusElement = document.querySelector('.stat-value.success');
                if (statusElement) {
                    statusElement.textContent = 'Error';
                    statusElement.classList.remove('success');
                    statusElement.classList.add('error');
                }
            }
            
            // Auto-run first test
            setTimeout(() => {
                console.log('Running initial test...');
                testJsonToCsv();
            }, 1000);
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl+1 to run Test 1
            if (e.ctrlKey && e.key === '1') {
                e.preventDefault();
                testJsonToCsv();
            }
            // Ctrl+2 to run Test 2
            if (e.ctrlKey && e.key === '2') {
                e.preventDefault();
                testCsvToJson();
            }
            // Ctrl+3 to run Test 3
            if (e.ctrlKey && e.key === '3') {
                e.preventDefault();
                testFileUpload();
            }
            // Ctrl+4 to run Test 4
            if (e.ctrlKey && e.key === '4') {
                e.preventDefault();
                testDownloadCsv();
            }
        });

        // Add tooltips for buttons
        document.querySelectorAll('button').forEach(button => {
            const originalTitle = button.getAttribute('title') || button.textContent;
            button.setAttribute('title', originalTitle + ' (Ctrl+' + (Array.from(document.querySelectorAll('button')).indexOf(button) + 1) + ')');
        });
    </script>
</body>
</html>